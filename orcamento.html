<!DOCTYPE html>
<html lang="pt-BR">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="description" content="Solicite orçamento técnico personalizado de máquinas, peças e reformas hidráulicas da ALS com atendimento especializado e envio rápido.">
  <title>ALS Máquinas | Solicitar Orçamento </title>

  <link rel="stylesheet" href="css/orcamento/orcamento.css">
  <link rel="stylesheet" href="css/style.css">
  <link rel="shortcut icon" href="assets/icons/favicon.svg" type="image/x-icon">

</head>

<body>
  <main id="conteudo-principal">
    <div class="layout-container">
      <div class="sidebar-image">
        <div class="sidebar-content">
          <h1>ALS - Excelência em Máquinas Industriais.</h1>
          <p>Orçamento técnico personalizado e soluções de alta performance para seu negócio.</p>
        </div>
      </div>

      <div class="form-side">

        <div class="header">
          <div class="logo-area">
            <a href="index.html">
              <img src="assets/imgs/logo-orcamento.svg" alt="ALS Máquinas Orçamentos">
            </a>
          </div>
          <div class="progress-header">
            <span class="step-title" id="stepTitle">Configuração Inicial</span>
            <span class="step-indicator" id="stepIndicator">1 / 5</span>
          </div>
          <div class="progress-container">
            <div class="progress-bar" id="progressBar"></div>
          </div>
        </div>

        <form id="quoteForm" onsubmit="return false;" style="display: flex; flex-direction: column; height: 100%;">

          <!-- ETAPA 1: Tipo de Solicitação -->
          <div class="step-content active" id="step1">
            <h2>O que você busca?</h2>
            <p class="subtitle">Selecione a categoria para iniciarmos.</p>

            <div class="form-group">
              <label for="requestTypeMachine">Categoria do Item *</label>
              <div class="selection-grid">
                <label class="radio-card">
                  <input id="requestTypeMachine" type="radio" name="requestType" value="Máquina" required onchange="handleTypeChange()">
                  <div class="card-visual">Máquina / Equipamento</div>
                </label>
                <label class="radio-card">
                  <input id="requestTypePeca" type="radio" name="requestType" value="Peça" onchange="handleTypeChange()">
                  <div class="card-visual">Peça de Reposição</div>
                </label>
              </div>
            </div>

            <div class="form-group">
              <label for="itemSelect">Item Específico *</label>
              <select id="itemSelect" required onchange="updateSpecsFields()">
                <option value="">Selecione o tipo primeiro...</option>
              </select>
            </div>

            <div class="form-group">
              <label>Objetivo *</label>
              <div class="selection-grid" id="objectiveGrid">
                <!-- Preenchido via JS -->
              </div>
            </div>
          </div>

          <!-- ETAPA 2: Contexto -->
          <div class="step-content" id="step2">
            <h2>Contexto de Uso</h2>
            <p class="subtitle">Entenda como sua máquina ou peça será utilizada.</p>

            <div class="form-group">
              <label for="application">Aplicação Principal *</label>
              <select id="application" required>
                <option value="">Selecione...</option>
                <option value="Indústria de Borracha">Indústria de Borracha</option>
                <option value="Vulcanização e Moldagem">Vulcanização e Moldagem</option>
                <option value="Metalúrgica / Siderúrgica">Metalúrgica / Siderúrgica</option>
                <option value="Reciclagem">Reciclagem</option>
                <option value="Projeto Especial">Projeto Especial</option>
                <option value="Outro">Outro</option>
              </select>
            </div>

            <div class="form-group">
              <label>Material / Fluido de Trabalho *</label>
              <div class="selection-grid">
                <label class="radio-card">
                  <input type="radio" name="material" value="Compostos de Borracha" required>
                  <div class="card-visual">Borracha / Polímeros</div>
                </label>
                <label class="radio-card">
                  <input type="radio" name="material" value="Metais / Sucata" required>
                  <div class="card-visual">Metais / Sucata</div>
                </label>
                <label class="radio-card">
                  <input type="radio" name="material" value="Óleo Hidráulico" required>
                  <div class="card-visual">Óleo Hidráulico</div>
                </label>
                <label class="radio-card">
                  <input type="radio" name="material" value="Outros / Não sei" required>
                  <div class="card-visual">Outros / Não sei</div>
                </label>
              </div>
            </div>

            <div class="form-group">
              <label for="deadline">Prazo desejado *</label>
              <select id="deadline" required>
                <option value="">Selecione...</option>
                <option value="Urgente (Parada de Máquina)">Urgente (Parada de Máquina)</option>
                <option value="Imediato (até 7 dias)">Imediato (até 7 dias)</option>
                <option value="Médio Prazo (15-30 dias)">Médio Prazo (15-30 dias)</option>
                <option value="Planejamento Futuro">Planejamento Futuro</option>
              </select>
            </div>
          </div>

          <!-- ETAPA 3: Especificações Técnicas (DINÂMICA) -->
          <div class="step-content" id="step3">
            <h2 id="specsTitle">Especificações</h2>
            <p class="subtitle" id="specsSubtitle">Detalhes técnicos do item selecionado.</p>

            <div id="dynamicSpecsContainer"></div>
          </div>

          <!-- ETAPA 4: Contato -->
          <div class="step-content" id="step4">
            <h2>Seus Dados</h2>
            <p class="subtitle">Para onde enviamos o orçamento?</p>

            <div class="form-group">
              <label for="clientName">Nome Completo *</label>
              <input type="text" id="clientName" required>
            </div>
            <div class="form-group">
              <label for="clientCompany">Empresa</label>
              <input type="text" id="clientCompany">
            </div>
            <div class="form-group">
              <label for="clientLocation">Cidade / UF</label>
              <input type="text" id="clientLocation" placeholder="Ex: São Paulo - SP">
            </div>
            <div class="form-group">
              <label for="finalNotes">Observações Adicionais</label>
              <textarea id="finalNotes" rows="3"></textarea>
            </div>
          </div>

          <!-- ETAPA 5: Revisão -->
          <div class="step-content" id="step5">
            <h2>Revisão</h2>
            <p class="subtitle">Confira os dados antes de gerar a mensagem.</p>

            <div class="summary-card" id="reviewSummary">
              <!-- Gerado via JS -->
            </div>
          </div>

          <!-- Tela de Sucesso -->
          <div class="step-content" id="stepSuccess">
            <div class="success-message">
              <div class="icon-success">✅</div>
              <h2>Solicitação Pronta!</h2>
              <p style="color: var(--text-secondary); margin-bottom: 20px; line-height: 1.6;">
                Seu orçamento foi formatado. Escolha uma opção abaixo:
              </p>

              <!-- Botões Alinhados Lado a Lado -->
              <div class="success-actions">
                <button type="button" class="btn btn-secondary" onclick="copyToClipboard()">
                  Copiar Texto
                </button>
                <button type="button" class="btn btn-primary btn-whatsapp" onclick="openWhatsAppUrl()">
                  Abrir WhatsApp
                </button>
              </div>

              <br><br>
              <button type="button" style="background:none; border:none; color: var(--als-red); font-weight: 600; cursor: pointer;" onclick="resetForm()">Começar Novo Orçamento</button>
            </div>
          </div>

          <!-- Botões de Navegação -->
          <div class="actions" id="navButtons">
            <!-- Botão Esquerdo (Mantém no DOM para layout, invisível na etapa 1) -->
            <button type="button" class="btn btn-secondary" id="btnPrev" onclick="prevStep()">Voltar</button>

            <!-- Botões Direita -->
            <div class="actions-right">
              <button type="button" class="btn btn-primary" id="btnNext" onclick="nextStep()">Continuar</button>

              <div id="finishButtons" class="hidden" style="display: flex; gap: 10px;">
                <button type="button" class="btn btn-secondary" onclick="copyToClipboard()">Copiar</button>
                <button type="button" class="btn btn-primary btn-whatsapp" onclick="sendToWhatsApp()">Enviar WhatsApp</button>
              </div>
            </div>
          </div>

        </form>
      </div>
    </div>
  </main>

  <script>
    /* * ARQUIVO: app.js
     * Lógica Dinâmica e Integração
     */

    const ALS_WHATSAPP_NUMBER = "5516991265833";
    const TOTAL_STEPS = 5;
    let currentStep = 1;

    // --- Configuração dos Itens ---
    const ITEMS_MACHINE = ["Prensas Hidráulicas", "Misturadores", "Guilhotinas", "Unidades Hidráulicas", "Raspadores", "Outra Máquina"];
    const ITEMS_PART = ["Bombas Hidráulicas", "Válvulas", "Gaxetas & Vedação", "Isoladores Térmicos", "Peça sob Medida"];

    const OBJECTIVES_MACHINE = ["Orçamento / Compra", "Projeto sob Demanda", "Manutenção / Reforma", "Modernização"];
    const OBJECTIVES_PART = ["Reposição", "Estoque", "Compatibilidade", "Consultoria"];

    // Prazo ajustado apenas para máquinas; peças mantêm a lista original
    const DEADLINES_PART = [
      "Urgente (Parada de Máquina)",
      "Imediato (até 7 dias)",
      "Médio Prazo (15-30 dias)",
      "Planejamento Futuro"
    ];

    const DEADLINES_MACHINE = [
      "Urgente (Parada de Máquina)",
      "Imediato (até 30 dias)",
      "Médio Prazo (30-60 dias)",
      "Planejamento Futuro"
    ];

    // --- Configuração dos Campos Dinâmicos (Etapa 3) ---
    const SPECS_CONFIG = {
      "Prensas Hidráulicas": `
                <div class="form-group"><label>Tamanho do Pistão</label><input type="text" id="spec1" placeholder="Diâmetro ou Toneladas"></div>
                <div class="form-group"><label>Tamanho do Platô (Mesa)</label><input type="text" id="spec2" placeholder="Ex: 600 x 600 mm"></div>
                <div class="form-group"><label>Qtd. Vãos / Altura de cada vão</label><input type="text" id="spec3" placeholder="Ex: 2 vãos de 200mm"></div>
                <div class="form-group"><label>Sistema de Aquecimento</label><select id="spec4"><option value="">Selecione...</option><option value="Elétrica">Elétrica</option><option value="Vapor">Vapor</option></select></div>
                <div class="form-group"><label>Tipo de Operação</label><select id="spec5"><option value="">Selecione...</option><option value="Automática">Automática</option><option value="Manual">Manual</option></select></div>`,

      "Misturadores": `
                <div class="form-group"><label>Capacidade da Câmara (Litros/Kg)</label><input type="text" id="spec1" placeholder="Ex: 50 Litros"></div>
                <div class="form-group"><label>Tipo de Rotor</label><select id="spec2"><option value="Tangencial">Tangencial</option><option value="Interpenetrante">Interpenetrante</option><option value="Não sei">Não sei</option></select></div>
                <div class="form-group"><label>Potência do Motor (CV)</label><input type="text" id="spec3" placeholder="Ex: 75 CV"></div>`,

      "Guilhotinas": `
                <div class="form-group"><label>Largura de Corte (mm)</label><input type="text" id="spec1" placeholder="Ex: 600mm, 1000mm"></div>
                <div class="form-group"><label>Espessura Máxima de Corte</label><input type="text" id="spec2" placeholder="Ex: 20mm de borracha crua"></div>
                <div class="form-group"><label>Tipo de Acionamento</label><select id="spec3"><option value="Hidráulico">Hidráulico</option><option value="Pneumático">Pneumático</option></select></div>`,

      "Unidades Hidráulicas": `
                <div class="form-group"><label>Pressão de Trabalho (Bar)</label><input type="text" id="spec1" placeholder="Ex: 210 Bar"></div>
                <div class="form-group"><label>Vazão da Bomba (L/min)</label><input type="text" id="spec2" placeholder="Ex: 40 L/min"></div>
                <div class="form-group"><label>Volume do Reservatório (Litros)</label><input type="text" id="spec3" placeholder="Ex: 100 Litros"></div>`,

      "Raspadores": `
                <div class="form-group"><label>Largura da Correia (mm)</label><input type="text" id="spec1" placeholder="Ex: 24 polegadas / 600mm"></div>
                <div class="form-group"><label>Tipo de Material da Lâmina</label><select id="spec2"><option value="Poliuretano">Poliuretano (PU)</option><option value="Tungstênio">Tungstênio</option><option value="Outro">Outro</option></select></div>
                <div class="form-group"><label>Modelo do Raspador</label><select id="spec3"><option value="Primário">Primário (Cabeça)</option><option value="Secundário">Secundário (Retorno)</option></select></div>`,

      "Gaxetas & Vedação": `
                <div class="form-group"><label>Diâmetro Interno x Externo</label><input type="text" id="spec1" placeholder="Ex: Ø50 x Ø60 mm"></div>
                <div class="form-group"><label>Altura / Perfil</label><input type="text" id="spec2" placeholder="Ex: 10mm"></div>
                <div class="form-group"><label>Fluido / Temperatura</label><input type="text" id="spec3" placeholder="Ex: Óleo mineral, 80°C"></div>`,

      // Fallback Genérico
      "default": `
                <div class="form-group"><label>Especificação Principal</label><input type="text" id="spec1" placeholder="Descreva medidas ou modelo"></div>
                <div class="form-group"><label>Referência / Código</label><input type="text" id="spec2" placeholder="Caso possua código da peça"></div>
                <div class="form-group"><label>Equipamento de Destino</label><input type="text" id="spec3" placeholder="Onde será instalado?"></div>`
    };

    const STEP_TITLES = ["Configuração Inicial", "Contexto de Uso", "Especificações", "Seus Dados", "Revisão"];

    // --- Inicialização ---
    document.addEventListener('DOMContentLoaded', () => {
      loadProgress();
      updateUI();

      document.getElementById('quoteForm').addEventListener('change', validateCurrentStep);
      document.getElementById('quoteForm').addEventListener('input', validateCurrentStep);
    });

    // --- Lógica de UI e Navegação ---
    function updateUI() {
      const progress = ((currentStep - 1) / (TOTAL_STEPS - 1)) * 100;
      document.getElementById('progressBar').style.width = `${progress}%`;

      if (currentStep <= TOTAL_STEPS) {
        document.getElementById('stepIndicator').innerText = `${currentStep} / ${TOTAL_STEPS}`;
        document.getElementById('stepTitle').innerText = STEP_TITLES[currentStep - 1];
      } else {
        document.getElementById('stepIndicator').innerText = "Concluído";
        document.getElementById('stepTitle').innerText = "Sucesso";
      }

      document.querySelectorAll('.step-content').forEach((el, index) => {
        if (index + 1 === currentStep) el.classList.add('active');
        else if (currentStep === 6 && el.id === 'stepSuccess') el.classList.add('active');
        else el.classList.remove('active');
      });

      const btnPrev = document.getElementById('btnPrev');
      const btnNext = document.getElementById('btnNext');
      const finishButtons = document.getElementById('finishButtons');

      btnNext.style.display = 'inline-flex';
      finishButtons.classList.add('hidden');
      finishButtons.style.display = 'none';

      if (currentStep === 1) {
        // Etapa 1: Botão Voltar existe no DOM mas fica invisível (mantém layout)
        btnPrev.disabled = true;
        btnPrev.style.visibility = 'hidden';
      } else if (currentStep === TOTAL_STEPS) {
        // Última etapa (Revisão): Mostra botões de finalizar
        btnNext.style.display = 'none';
        finishButtons.classList.remove('hidden');
        finishButtons.style.display = 'flex';

        // Garante que o botão voltar esteja visível
        btnPrev.disabled = false;
        btnPrev.style.visibility = 'visible';
        generateSummary();
      } else if (currentStep > TOTAL_STEPS) {
        // Tela de sucesso
        document.getElementById('navButtons').style.display = 'none';
      } else {
        // Etapas intermediárias: Botão voltar visível e habilitado
        btnPrev.disabled = false;
        btnPrev.style.visibility = 'visible';
      }

      validateCurrentStep();
    }

    function nextStep() {
      if (currentStep < TOTAL_STEPS) {
        currentStep++;
        saveProgress();
        updateUI();
      }
    }

    function prevStep() {
      if (currentStep > 1) {
        currentStep--;
        updateUI();
      }
    }

    // --- Lógica Dinâmica ---
    function handleTypeChange() {
      const type = document.querySelector('input[name="requestType"]:checked')?.value;
      const itemSelect = document.getElementById('itemSelect');
      const objectiveGrid = document.getElementById('objectiveGrid');
      updateDeadlineOptions(type);

      itemSelect.innerHTML = '<option value="">Selecione o item...</option>';
      objectiveGrid.innerHTML = '';

      let itemsList = (type === 'Máquina') ? ITEMS_MACHINE : ITEMS_PART;
      let objectivesList = (type === 'Máquina') ? OBJECTIVES_MACHINE : OBJECTIVES_PART;

      itemsList.forEach(item => {
        const opt = document.createElement('option');
        opt.value = item;
        opt.innerText = item;
        itemSelect.appendChild(opt);
      });

      objectivesList.forEach((obj) => {
        const label = document.createElement('label');
        label.className = 'radio-card';
        label.innerHTML = `<input type="radio" name="objective" value="${obj}" required><div class="card-visual">${obj}</div>`;
        objectiveGrid.appendChild(label);
      });

      validateCurrentStep();
      updateSpecsFields(); // Limpa/Atualiza specs ao mudar tipo
    }

    function updateDeadlineOptions(type) {
      const deadlineSelect = document.getElementById('deadline');
      if (!deadlineSelect) return;
      const optionsList = type === 'Máquina' ? DEADLINES_MACHINE : DEADLINES_PART;
      const currentValue = deadlineSelect.value;

      // Reconstrói as opções
      deadlineSelect.innerHTML = '<option value="">Selecione...</option>';
      optionsList.forEach((opt) => {
        const optionEl = document.createElement('option');
        optionEl.value = opt;
        optionEl.innerText = opt;
        deadlineSelect.appendChild(optionEl);
      });

      // Se o valor atual ainda existir, mantém; senão reseta para vazio
      const stillExists = optionsList.includes(currentValue);
      deadlineSelect.value = stillExists ? currentValue : "";
    }

    function updateSpecsFields() {
      const selectedItem = document.getElementById('itemSelect').value;
      const container = document.getElementById('dynamicSpecsContainer');

      // Busca o HTML específico ou usa o default
      let htmlContent = SPECS_CONFIG[selectedItem] || SPECS_CONFIG["default"];

      // Injeta o HTML
      container.innerHTML = htmlContent;
    }

    // --- Validação ---
    function validateCurrentStep() {
      const btnNext = document.getElementById('btnNext');
      let isValid = false;

      if (currentStep === 1) {
        const type = document.querySelector('input[name="requestType"]:checked');
        const item = document.getElementById('itemSelect').value;
        const objective = document.querySelector('input[name="objective"]:checked');
        isValid = type && item && objective;
      }
      else if (currentStep === 2) {
        const app = document.getElementById('application').value;
        const material = document.querySelector('input[name="material"]:checked');
        const deadline = document.getElementById('deadline').value;
        isValid = app !== "" && material && deadline !== "";
      }
      else if (currentStep === 3) {
        isValid = true; // Specs opcionais
      }
      else if (currentStep === 4) {
        const name = document.getElementById('clientName').value.trim();
        isValid = name.length > 2;
      }

      btnNext.disabled = !isValid;
      return isValid;
    }

    function getFormData() {
      const val = (id) => document.getElementById(id)?.value || '';
      const radio = (name) => document.querySelector(`input[name="${name}"]:checked`)?.value || 'N/A';

      // Pega os labels dos campos dinâmicos da etapa 3 para o resumo
      const spec1Label = document.querySelector('#step3 label:nth-of-type(1)')?.innerText || 'Spec 1';

      return {
        type: radio('requestType'),
        item: val('itemSelect'),
        objective: radio('objective'),
        application: val('application'),
        material: radio('material'), // Novo campo Material
        deadline: val('deadline'),

        // Specs Dinâmicas (pega pelo ID genérico injetado)
        spec1: val('spec1'),
        spec2: val('spec2'),
        spec3: val('spec3'),

        // Labels para exibir corretamente no resumo/whatsapp
        labelSpec1: document.querySelector('#dynamicSpecsContainer .form-group:nth-child(1) label')?.innerText || 'Spec 1',
        labelSpec2: document.querySelector('#dynamicSpecsContainer .form-group:nth-child(2) label')?.innerText || 'Spec 2',
        labelSpec3: document.querySelector('#dynamicSpecsContainer .form-group:nth-child(3) label')?.innerText || 'Spec 3',

        name: val('clientName'),
        company: val('clientCompany'),
        location: val('clientLocation'),
        notes: val('finalNotes')
      };
    }

    function generateSummary() {
      const data = getFormData();
      const container = document.getElementById('reviewSummary');
      let html = '';

      const addRow = (label, value) => {
        if (value && value !== 'N/A' && value !== '') {
          html += `<div class="summary-row"><span class="summary-label">${label}</span><span class="summary-value">${value}</span></div>`;
        }
      };

      addRow("Tipo", data.type);
      addRow("Item", data.item);
      addRow("Objetivo", data.objective);
      addRow("Aplicação", data.application);
      addRow("Material", data.material);
      addRow("Prazo", data.deadline);

      // Adiciona specs dinâmicas usando os labels corretos
      addRow(data.labelSpec1, data.spec1);
      addRow(data.labelSpec2, data.spec2);
      addRow(data.labelSpec3, data.spec3);

      addRow("Cliente", data.name);
      addRow("Empresa", data.company);

      container.innerHTML = html;
    }

    function buildWhatsAppMessage() {
      const data = getFormData();
      const date = new Date().toLocaleDateString('pt-BR');

      let msg = `Olá ALS, gostaria de um orçamento.\n\n`;

      msg += `*SOLICITAÇÃO (${date})*\n`;
      msg += `*Item:* ${data.type} > ${data.item}\n`;
      msg += `*Objetivo:* ${data.objective}\n`;
      msg += `*Prazo:* ${data.deadline}\n\n`;

      msg += `*CONTEXTO*\n`;
      msg += `*Aplicação:* ${data.application}\n`;
      msg += `*Material:* ${data.material}\n\n`;

      msg += `*ESPECIFICAÇÕES*\n`;
      if (data.spec1) msg += `- ${data.labelSpec1}: ${data.spec1}\n`;
      if (data.spec2) msg += `- ${data.labelSpec2}: ${data.spec2}\n`;
      if (data.spec3) msg += `- ${data.labelSpec3}: ${data.spec3}\n`;
      msg += `\n`;

      msg += `*CONTATO*\n`;
      msg += `${data.name}\n`;
      if (data.company) msg += `${data.company}\n`;
      if (data.location) msg += `${data.location}\n`;
      if (data.notes) msg += `${data.notes}`;

      return msg;
    }

    function sendToWhatsApp() {
      currentStep = 6;
      updateUI();
      localStorage.removeItem('alsQuoteProgress');
      openWhatsAppUrl();
    }

    function openWhatsAppUrl() {
      const message = buildWhatsAppMessage();
      const url = `https://wa.me/${ALS_WHATSAPP_NUMBER}?text=${encodeURIComponent(message)}`;
      window.open(url, '_blank');
    }

    function copyToClipboard() {
      const message = buildWhatsAppMessage();
      navigator.clipboard.writeText(message).then(() => {
        alert("Texto copiado! Cole no WhatsApp.");
      });
    }

    function resetForm() {
      localStorage.removeItem('alsQuoteProgress');
      location.reload();
    }

    function saveProgress() {
      const data = getFormData();
      const state = { step: currentStep, data: data };
      localStorage.setItem('alsQuoteProgress', JSON.stringify(state));
    }

    function loadProgress() {
      const saved = localStorage.getItem('alsQuoteProgress');
      // Implementação simples de restore poderia vir aqui
    }
  </script>
</body>

</html>